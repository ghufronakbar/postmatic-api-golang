# Refactoring Code

Anda adalah backend engineer Golang professional.

## Tujuan:

- Melakukan refactoring code

## Rules:

- Jangan ubah request/response dan business logic
- Pastikan code berfungsi sama seperti sebelumnya
- Pastika bisa di build dengan command `go ./cmd/api/main.go`

## Description:

Legacy untuk struktur folder saya adalah sebagai berikut:

Root: `.`

```text
.
- .air.toml
- .build/
  - postmatic-api
- .gitignore
- .golangci.yml
- Makefile
- Md/
  - 00_Refactor.md
- Review.md
- air.sh
- build.sh
- cmd/
  - api/
    - main.go
  - seed/
    - creator_image_seed/
      - creator_image.json
      - main.go
    - rss_seed/
      - main.go
      - rss.json
- config/
  - asynq.go
  - config.go
  - database.go
  - google_oauth.go
  - redis.go
  - s3.go
- down.sh
- gen-env-example.sh
- go.mod
- go.sum
- internal/
  - http/
    - handler/
      - account_handler/
        - auth_handler.go
        - cookie_handler.go
        - google_oauth_handler.go
        - profile_handler.go
        - session_handler.go
      - affiliator_handler/
        - referral_basic_handler.go
      - app_handler/
        - category_creator_image_handler.go
        - image_uploader_handler.go
        - referral_rule_handler.go
        - rss_handler.go
        - timezone_handler.go
        - token_product_handler.go
      - business_handler/
        - business_image_content_handler.go
        - business_information_handler.go
        - business_knowledge_handler.go
        - business_member_handler.go
        - business_product_handler.go
        - business_role_handler.go
        - business_rss_subscription_handler.go
        - business_timezone_pref_handler.go
      - creator_handler/
        - creator_image_handler.go
    - middleware/
      - auth.go
      - logger.go
      - owned_business.go
      - req_filter.go
    - router.go
  - module/
    - account/
      - auth/
        - dto.go
        - service.go
        - viewmodel.go
      - google_oauth/
        - dto.go
        - service.go
        - viewmodel.go
      - profile/
        - dto.go
        - service.go
        - viewmodel.go
      - session/
        - dto.go
        - service.go
        - viewmodel.go
    - affiliator/
      - referral_basic/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
    - app/
      - category_creator_image/
        - filter.go
        - service.go
        - viewmodel.go
      - image_uploader/
        - service.go
        - viewmodel.go
      - referral_rule/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
      - rss/
        - filter.go
        - service.go
        - viewmodel.go
      - timezone/
        - service.go
        - timezone.json
        - viewmodel.go
      - token_product/
        - dto.go
        - filter.go
        - helper.go
        - service.go
        - viewmodel.go
    - business/
      - business_image_content/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
      - business_information/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
      - business_knowledge/
        - dto.go
        - service.go
        - viewmodel.go
      - business_member/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
      - business_product/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
      - business_role/
        - dto.go
        - service.go
        - viewmodel.go
      - business_rss_subscription/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
      - business_timezone_pref/
        - dto.go
        - service.go
        - viewmodel.go
    - creator/
      - creator_image/
        - dto.go
        - filter.go
        - service.go
        - viewmodel.go
    - headless/
      - cloudinary_uploader/
        - service.go
        - viewmodel.go
      - mailer/
        - constants.go
        - dto.go
        - mail.go
        - service.go
        - templates/
          - layout.html
          - member_announce_kick.html
          - member_announce_role.html
          - member_invitation.html
          - member_welcome_business.html
          - reset_password.html
          - verification.html
          - welcome.html
      - queue/
        - enqueue.go
        - mailer.go
        - producer.go
        - worker.go
      - s3_uploader/
        - dto.go
        - service.go
        - viewmodel.go
      - token/
        - access_token.go
        - create_account_token.go
        - invitation_token.go
        - refresh_token.go
        - service.go
  - repository/
    - entity/
      - app_creator_image_product_category.sql.go
      - app_creator_image_type_category.sql.go
      - app_profile_referral_change.sql.go
      - app_profile_referral_rules.sql.go
      - app_rss_category.sql.go
      - app_rss_feed.sql.go
      - app_token_product.sql.go
      - business_image_content.sql.go
      - business_knowledge.sql.go
      - business_member.sql.go
      - business_member_status_history.sql.go
      - business_product.sql.go
      - business_role.sql.go
      - business_root.sql.go
      - business_rss_subscription.sql.go
      - business_timezone_pref.sql.go
      - creator_image.sql.go
      - db.go
      - models.go
      - profile.sql.go
      - profile_referral_code.sql.go
      - querier.go
      - store.go
      - uploaded_image.sql.go
      - user.sql.go
    - queries/
      - app_creator_image_product_category.sql
      - app_creator_image_type_category.sql
      - app_profile_referral_change.sql
      - app_profile_referral_rules.sql
      - app_rss_category.sql
      - app_rss_feed.sql
      - app_token_product.sql
      - business_image_content.sql
      - business_knowledge.sql
      - business_member.sql
      - business_member_status_history.sql
      - business_product.sql
      - business_role.sql
      - business_root.sql
      - business_rss_subscription.sql
      - business_timezone_pref.sql
      - creator_image.sql
      - profile.sql
      - profile_referral_code.sql
      - uploaded_image.sql
      - user.sql
    - redis/
      - email_limiter_repository/
        - dto.go
        - email_limiter_repository.go
        - viewmodel.go
      - invitation_limiter_repository/
        - dto.go
        - invitation_limiter_repository.go
        - viewmodel.go
      - owned_business_repository/
        - dto.go
        - owned_business_repository.go
        - viewmodel.go
      - session_repository/
        - dto.go
        - session_repository.go
- migration_record.sql
- migrations/
  - 20251214120953_init_extension.sql
  - 20251214121038_create_users_profiles_table.sql
  - 20251218125633_create_business_bknowledge_bproduct_brole_brsssubscription.sql
  - 20251218133145_create_members_table.sql
  - 20251221135856_create_uploaded_images_table.sql
  - 20251225112121_create_app_rss_app_rss_category_table.sql
  - 20251225123316_alter_business_rss_subscriptions_table.sql
  - 20251225211811_create_business_timezone_prefs_table.sql
  - 20251226135819_create_creator_images_and_app_creator_image_type_categories_and_app_creator_image_product_categories_table.sql
  - 20251227121443_alter_uploaded_images_add_s3.sql
  - 20251230162912_create_business_image_contents_table.sql
  - 20260101161623_trigger_business_member_invitation_histories_to_updated_at_member_histories.sql
  - 20260101162042_alter_type_business_member_status.sql
  - 20260102141123_create_type_app_role_alter_profile.sql
  - 20260102153913_create_app_profile_referral_rules_table.sql
  - 20260102173819_create_profile_referral_codes.sql
  - 20260106163450_create_app_token_products_table.sql
- pkg/
  - errs/
    - app_error.go
  - filter/
    - date.go
    - filter.go
  - hash/
    - hash.go
  - logger/
    - logger.go
  - pagination/
    - pagination.go
  - response/
    - response.go
  - token/
  - utils/
    - client_info.go
    - parse.go
    - password.go
    - query_params.go
    - slice.go
    - sql.go
    - validator.go
- schema.sh
- seed.sh
- seeders/
  - 1_profile_user.sql
- sqlc.yaml
- structure.sh
- test.js
- up.sh
```

Tujuan refactor struktur folder sebagai berikut:
Root: `.`

```text
.
- cmd/
  - api/
    - main.go
  - seed/
    - creator_image_seed/
      - creator_image.json
      - main.go
    - rss_seed/
      - main.go
      - rss.json
- config/
  - asynq.go
  - config.go
  - database.go
  - google_oauth.go
  - redis.go
  - s3.go
  - cloudinary.go // ubah config cloudinary disini yang awalnya di service
- internal/
  - internal_middleware/
    - auth.go
    - logger.go
    - owned_business.go
    - req_filter.go
  - router.go
  - module/
    - account/
      - auth/
        - service/
          - dto.go
          - service.go
          - viewmodel.go
        - handler/
          - handler.go
    - affiliator/
      - referral_basic/
        - service/
          - dto.go
          - service.go
          - viewmodel.go
        - handler/
          - handler.go
    - app/
      - category_creator_image/
        - service/
          - dto.go
          - service.go
          - viewmodel.go
        - handler/
          - handler.go
      - image_uploader/
        - service/
          - dto.go
          - service.go
          - viewmodel.go
        - handler/
          - handler.go
```

Note:
tujuan utama adalah membuat handler berada pada di folder module.

Refactor Style Code:

- untuk package di service ditulis seperti `image_uploader_service` seperti pada di folder `internal/module/app/image_uploader/service`
- untuk package di handler ditulis seperti `image_uploader_handler` seperti pada di folder `internal/module/app/image_uploader/handler`
- mounting route di `internal/router.go`
- mounting route per handler di `internal/module/app/*/handler/handler.go`
- untuk penulisan service pastikan pakai NewService(), bukan NewImageUploaderService() dan segala macamnya
- untuk penulisan handler pastikan pakai NewHandler(), bukan NewImageUploaderHandler() dan segala macamnya
- perbaiki penulisan middleware
- perbaiki `internal/router.go` agar tidak ada init di router untuk seperti config, redis
